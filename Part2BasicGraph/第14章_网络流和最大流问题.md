# 第14章 网络流和最大流问题

## 14.1 网络流和最大流问题阐述
### 网络流基本概念
> 网络流图中，从源点出发，在满足每条边容量限制的条件下，汇点t最多能接收多少流量
![网络流的基本概念](images/第14章_网络流和最大流/网络流的基本概念.png)
+ s:source
+ t:target
### 网络流需要满足的限制
+ 容量限制
+ 平衡限制：除了源点s和汇点t，对于每一个点，流入量等于流出量
+ 从源点s流出的流量，一定等于最终汇入汇点t的流量
![网络流问题需要满足的限制](images/第14章_网络流和最大流/网络流问题需要满足的限制.png)

### 引出最大流问题
> 网络流图中，从源点s出发，在满足每条边容量限制、平衡限制的条件下，汇点t最多能接收多少流量？

## 14.2 Ford-Fulkerson思想
> Ford-Fulkerson思想的核心是当路径上的容量限制小于流量时，把流量改成负值加到图上，这个加上的流量叫残量，在残量图中不算找增广路径，直到没有增广路径为止~~

### 手动求最大流的风险
+ 1.初始化网络流图：建立一个有向图，标注上流量(蓝色字体)和容量(黑色字体)
  > ![初始化网络流图](images/第14章_网络流和最大流/初始化网络流图.png)
+ 2.手动模拟不难得出该图的最大流应该是5，路线如下图所示：
  > ![手动得到网络流的最大流](images/第14章_网络流和最大流/手动得到网络流的最大流.png)
+ 3.手动找最大流方法的思想：随便找一条s到t的路径，只要路径还没满就接着找~直到无法再继续往t汇入流量。
  > 这个思路是有问题的，前面选择的路径不对很可能得不到正确的最大流.如下图，如果上来就走0->1->2->3的路线，路线上直接传流量3，那么后续其他路径也没法走了，最终t只能得到3，显然不是最大流
  > ![手动模拟存在的问题](images/第14章_网络流和最大流/手动模拟存在的问题.png)
  > ![手动模拟存在的问题2](images/第14章_网络流和最大流/手动模拟存在的问题2.png)
### 引入Ford-Fulkerson思想
+ 1.针对上面手动法的问题，我们可以引入`负流量和反向边`，即虚拟一条`2->1`的流量值2，和原来的3抵消，`1->2`的流量还剩1，再从1->2把流入1的2个流量流入到3，即完成了最大流5的求解。这便是Ford-Fulkerson思想
  > ![引入负流边](images/第14章_网络流和最大流/引入负流边.png)
+ 2.残量图和增广路径的概念和图示
  + 增广路径：所有边的权值都大于0的图中的路径
  + 残量图：记录流量流过后，正向边权值剩余和反向边权值大小的图
  > ![Ford-Fulkerson思想的理论描述](images/第14章_网络流和最大流/残量图和增广路径.png)
+ 3.上面描述经过理论抽象后为：在残量图中不断寻找增广路径，直到没有增广路径，汇入点的流量即为图的最大流。
  > ![Ford-Fulkerson思想](images/第14章_网络流和最大流/Ford-Fulkerson思想的理论描述.png)

## 14.3~14.4 Edmonds-Karp算法
> 不断进行BFS寻找增广路经和更新残量图，直到找不到增广路径。最后所有增广路径的流量加起来就是最大流。注意两个事项：
+ 1.残量图中，权值为0的边不能走(不管是正向边还是反向边，反向边代表可以回流的流量，前提是正向边已经流入了流量)
+ 2.每次BFS遍历到一条增广路径后，都要重新更新残量图，然后进行下一轮的BFS，按照上一步的原则，直到找不到增广路径为止

> 下面是一个详细的用上面思路找最大流的过程，以下图为例：
![Edmonds-Karp算法模拟](images/第14章_网络流和最大流/Edmonds-Karp算法模拟.png)
+ 1.第1遍BFS遍历，得到一条增广路径`0->1->3`，取边`0->1`和`1->3`的较小权值2，所以从0出流量2，更新残量网络后如下：
  > ![Edmonds-Karp算法模拟1](images/第14章_网络流和最大流/Edmonds-Karp算法模拟1.png)
+ 2.第2遍BFS遍历，得到一条增广路径`0->2->3`，注意不能走权值为0的边`2->1`和`1->3`，取边`0->2`和`2->3`的较小权值2，所以从0出流量2到2，更新残量网络后如下：
  > ![Edmonds-Karp算法模拟2](images/第14章_网络流和最大流/Edmonds-Karp算法模拟2.png)
+ 3.第3遍BFS遍历，得到一条增广路径`0-1->>2->3`，注意不能走权值为0的边`0->2`和`1->3`，取边`0->1`、`1->2`和`2->3`的较小权值1，所以从0出流量1到1，更新残量网络后如下：
  > ![Edmonds-Karp算法模拟3](images/第14章_网络流和最大流/Edmonds-Karp算法模拟3.png)
+ 4.第4边BFS遍历，0的邻接边向外的权值都已经为0，无法在进行BFS遍历，所以算法执行完毕，最大流就是汇点所有临边的入流量值`2+3=5`

### Edmonds-Karp算法实现和测试
+ [实现代码](src/main/java/Chapter14NetworkFlowsAndMaxFlows/MaxFlow.java)
+ [测试代码](src/main/java/Chapter14NetworkFlowsAndMaxFlows/Main.java)
  > 两个测试用例图如下：
  ![测试用例1](https://img.mukewang.com/szimg/5e0563f50001412e17281080.jpg)
  ![测试用例2](https://img.mukewang.com/szimg/5e0568970001f72217281080.jpg)

